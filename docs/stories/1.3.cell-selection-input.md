# Story 1.3: Cell Selection and Input Handling

## Status

**Draft**

## Story

**As a** Sudoku player,
**I want** to click cells and enter numbers 1-9,
**so that** I can fill in my solution to the puzzle.

## Acceptance Criteria

1. Clicking any empty cell selects it with clear visual feedback (e.g., highlight, border change, background color)
2. Only one cell can be selected at a time
3. Clicking a given clue cell has no effect (cannot be selected or modified)
4. When a cell is selected, typing numbers 1-9 on the keyboard fills that cell with the entered number
5. Typing any other key (letters, symbols, etc.) is ignored
6. Previously entered numbers can be changed by clicking the cell and typing a new number 1-9
7. Pressing Delete, Backspace, or 0 clears the selected cell's content
8. The entered numbers are styled differently from given clues (e.g., regular weight font, different color)
9. Cell selection state persists until another cell is clicked or the selection is explicitly cleared

## Tasks / Subtasks

- [ ] Extend state module (scripts/state.js) (AC: 4, 6, 7, 8)
  - [ ] Add `selectedCell` property: `{ row: number, col: number } | null`
  - [ ] Implement `setSelectedCell(row, col)` - sets selection
  - [ ] Implement `getSelectedCell()` - returns current selection
  - [ ] Implement `clearSelection()` - clears selection
  - [ ] Implement `setCellValue(row, col, value)` - updates cell value
  - [ ] Implement `clearCell(row, col)` - sets cell to 0
  - [ ] Implement `isGivenClue(row, col)` - checks if cell is immutable

- [ ] Extend UI module (scripts/ui.js) (AC: 1, 2, 8)
  - [ ] Implement `highlightSelectedCell(row, col)` - adds 'selected' CSS class
  - [ ] Implement `clearSelection()` - removes all 'selected' classes
  - [ ] Update `renderCell()` to apply 'user-entry' class for non-given values
  - [ ] Ensure 'given-clue' and 'user-entry' are mutually exclusive classes

- [ ] Implement cell click handler in main.js (AC: 1, 2, 3, 9)
  - [ ] Add click event listener to sudoku-grid (event delegation)
  - [ ] Implement `handleCellClick(event)` function
  - [ ] Get row/col from clicked cell's data attributes
  - [ ] Check if cell is a given clue using `state.isGivenClue()`
  - [ ] If given clue, ignore click (return early)
  - [ ] If not given clue, call `state.setSelectedCell(row, col)`
  - [ ] Call `ui.clearSelection()` then `ui.highlightSelectedCell(row, col)`
  - [ ] Selection persists until next click

- [ ] Implement keyboard input handler in main.js (AC: 4, 5, 6, 7)
  - [ ] Add keydown event listener to document
  - [ ] Implement `handleKeyPress(event)` function
  - [ ] Check if a cell is selected (exit if none)
  - [ ] Get selected cell coordinates from state
  - [ ] Handle number keys 1-9:
    - Call `state.setCellValue(row, col, number)`
    - Call `ui.renderGrid()` to update display
  - [ ] Handle Delete/Backspace/0:
    - Call `state.clearCell(row, col)`
    - Call `ui.renderGrid()` to update display
  - [ ] Ignore all other keys

- [ ] Update CSS for cell selection and user entries (AC: 1, 8)
  - [ ] `.cell.selected`: Add highlight background (e.g., #e3f2fd light blue)
  - [ ] `.cell.selected`: Add outline or border (e.g., 2px solid #0066cc)
  - [ ] `.cell.user-entry`: Regular font weight, distinct color (e.g., #0066cc blue)
  - [ ] Ensure visual distinction between given-clue and user-entry

- [ ] Update main.js init() function
  - [ ] Attach cell click event listener
  - [ ] Attach keyboard event listener
  - [ ] Test event handlers work correctly

## Dev Notes

### Architecture Context

**State Management Pattern:**
- All state mutations go through state.js public API
- Never modify grid array directly from other modules
- State changes trigger UI updates via explicit re-renders

**Event Handling Strategy:**
- **Event Delegation:** Use single click listener on grid container, not 81 individual listeners
- **Document-level keyboard listener:** Captures all key presses when cell selected
- **Grid indexing:** Use data attributes (data-row, data-col) to identify clicked cells

**Grid Indexing:**
- All indices are 0-based (0-8 for rows and columns)
- Validate indices are in range before array access
- Cell coordinates format: `{row: number, col: number}`

**Cell Selection Logic:**
```javascript
function handleCellClick(event) {
  if (!event.target.classList.contains('cell')) return;

  const row = parseInt(event.target.dataset.row);
  const col = parseInt(event.target.dataset.col);

  if (state.isGivenClue(row, col)) {
    return; // Ignore clicks on given clues
  }

  state.setSelectedCell(row, col);
  ui.clearSelection();
  ui.highlightSelectedCell(row, col);
}
```

**Keyboard Input Logic:**
```javascript
function handleKeyPress(event) {
  const selected = state.getSelectedCell();
  if (!selected) return;

  const key = event.key;

  // Numbers 1-9
  if (/^[1-9]$/.test(key)) {
    state.setCellValue(selected.row, selected.col, parseInt(key));
    ui.renderGrid(state.getGrid(), state.getErrors(), state.getInitialGrid());
  }
  // Clear cell
  else if (key === 'Backspace' || key === 'Delete' || key === '0') {
    state.clearCell(selected.row, selected.col);
    ui.renderGrid(state.getGrid(), state.getErrors(), state.getInitialGrid());
  }
  // Ignore all other keys
}
```

**CSS Classes:**
- `.cell.given-clue` - Immutable cells from puzzle
- `.cell.user-entry` - User-filled cells (can be modified)
- `.cell.selected` - Currently selected cell (highlight)
- `.cell.error` - Cell with validation error (added in Story 1.4)

**State Module Extensions:**
```javascript
let selectedCell = null; // {row, col} or null

export function setSelectedCell(row, col) {
  selectedCell = { row, col };
}

export function getSelectedCell() {
  return selectedCell;
}

export function clearSelection() {
  selectedCell = null;
}

export function isGivenClue(row, col) {
  return initialGrid[row][col] !== 0;
}

export function setCellValue(row, col, value) {
  if (!isGivenClue(row, col)) {
    grid[row][col] = value;
    // Validation will be added in Story 1.4
  }
}

export function clearCell(row, col) {
  if (!isGivenClue(row, col)) {
    grid[row][col] = 0;
  }
}
```

### Testing

**Testing Strategy:** Manual interaction testing

**Test Checklist:**
1. **Cell Selection:**
   - Click an empty cell → verify it highlights (blue background)
   - Click a different empty cell → verify selection moves
   - Click a given clue cell → verify no highlight, no selection

2. **Number Input:**
   - Select a cell, type 1-9 → verify number appears in cell
   - Number should be blue color (user-entry styling)
   - Select cell with number, type different number → verify it replaces

3. **Clear Input:**
   - Select cell with user-entered number
   - Press Backspace → verify cell clears
   - Press Delete → verify cell clears
   - Press 0 → verify cell clears

4. **Invalid Input:**
   - Select a cell, type letters → verify nothing happens
   - Type symbols → verify ignored
   - Type numbers with no cell selected → verify nothing happens

5. **Given Clue Protection:**
   - Try to click given clue cells → verify no selection
   - Select empty cell, fill it, then verify you CAN modify it (not locked like given clues)

6. **Visual Styling:**
   - Verify user-entered numbers have different style from given clues
   - Verify selected cell has clear visual highlight

**Performance:** Interactions should respond within 100ms (NFR2)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-24 | 1.0 | Initial story creation from PRD | Sarah (PO) |

## Dev Agent Record

### Agent Model Used

*(To be filled by dev agent)*

### Debug Log References

*(To be filled by dev agent)*

### Completion Notes

*(To be filled by dev agent)*

### File List

*(To be filled by dev agent)*

## QA Results

*(To be filled by QA agent)*